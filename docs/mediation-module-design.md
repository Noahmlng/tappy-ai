# Mediation 模块设计文档（Draft）

- 文档版本：v0.3
- 最近更新：2026-02-21
- 角色定位：本文件专注描述 Mediation 层的模块边界、战略价值与阶段性设计重点，用于后续连续讨论与迭代。

## 1. 模块使命

Mediation 层的使命是：
1. 让 AI 应用能够低成本、低摩擦地接入广告网络。
2. 在“兼容现有生态”的前提下，持续提升请求质量与机会质量。
3. 沉淀可被 Network / DSP / 广告主认可的差异化信号与认知。

## 2. 模块边界

Mediation 负责：
1. 接入标准的定义与演进（从兼容到增强）。
2. 不同广告供给侧之间的适配、路由与协调。
3. 动态 placement 的策略编排与迭代。
4. AI Workflow 相关机会信号的提炼与输出。

Mediation 不直接等同于：
1. 完整 SSP 交易层（这是下一阶段目标）。
2. 完整 DSP 决策层（当前仅保持探索与观察）。

## 3. 当前阶段定位（Mediation First）

现阶段现实：
1. 生态资源仍在冷启动，应用方与广告商数量有限。
2. 早期直接连接 DSP 与大型 Ads Network 存在现实限制。

现阶段主策略：
1. 先通过广告联盟与模拟广告库搭建可运行网络能力。
2. 把研发主焦点放在 Mediation 层，先形成稳定的接入与价值闭环。

## 4. 关键能力框架

### 4.1 接入与兼容能力

1. 对齐主流 SSP 输入认知，确保“先可接入”。
2. 建立可扩展的兼容层，适应不同平台与新型应用形态。

### 4.2 动态编排能力

1. 围绕不同应用类型与 placement 场景做动态路由。
2. 在“接入效率、体验质量、商业价值”之间持续优化平衡。

### 4.3 机会挖掘能力

1. 持续提炼可提升出价意愿与机会匹配度的信号。
2. 从数据维度与业务 insight 两条线并行挖掘价值。

### 4.4 认知沉淀能力

1. 将 AI Workflow 中可复用的规律沉淀为长期资产。
2. 让每一轮接入和投放反馈都能反哺标准与策略演进。

## 5. 阶段性演进（Mediation 视角）

### 5.1 冷启动阶段（0 -> 1）

目标：
1. 快速建立可接入、可运行、可验证的 Mediation 基线能力。

阶段重点：
1. 打通基础供给与基础流量闭环。
2. 建立第一版“价值可证明”的输出。

### 5.2 扩展阶段（1 -> N）

目标：
1. 扩大应用类型覆盖与 placement 覆盖。
2. 在更多场景中持续验证 Mediation 的增量价值。

阶段重点：
1. 形成可规模复用的能力矩阵。
2. 让“接得快”与“接得好”同时成立。

### 5.3 向 SSP 过渡阶段

目标：
1. 为 SSP 化准备可交易、可信任、可持续迭代的信号与标准。

阶段重点：
1. 将已验证的质量能力、机会能力、意图能力逐步产品化。
2. 降低从 Mediation 升级到 SSP 的结构性重构成本。

## 6. 约束与风险

1. 过度追求兼容可能导致创新能力不足。
2. 过早追求创新可能牺牲接入效率与生态可用性。
3. 数据与洞察若缺少稳定反馈回路，难以形成真实壁垒。

## 7. Mediation v1 最小能力包（执行计划）

### 7.1 v1 目标

1. 建立一套可落地的 Mediation 基线能力，支撑冷启动阶段的真实接入与运行。
2. 以最小工程复杂度打通“应用接入 -> 供给路由 -> 广告返回 -> 事件回传”完整闭环。
3. 为后续 Stage 2 的 placement 扩展和 Stage 3 的 SSP 化保留清晰升级接口。

### 7.2 v1 包含能力（In Scope）

1. 接入标准基线：
定义 v1 接入合同与内部统一模型，并建立兼容层映射。
2. 供给侧适配基线：
接入广告联盟与模拟广告库两类供给，形成可路由供给池。
3. 动态 placement 基线：
支持基础 placement 编排与规则路由，按场景执行供给分发。
4. 返回标准化基线：
统一广告返回结构，屏蔽不同供给源差异。
5. 事件回传基线：
打通曝光/点击等核心事件上报链路，并保证请求级可追踪。
6. 运行控制基线：
提供开关、降级、回退等基础运行控制能力。

### 7.3 v1 不包含能力（Out of Scope）

1. 完整 SSP 交易能力与高级实时竞价机制。
2. 复杂 DSP 策略引擎与广告主管理系统。
3. 深度用户建模与全量风控体系。
4. 大规模自动优化与复杂实验平台。

### 7.4 v1 里程碑与 Substeps

#### M1：接入与适配基线

1. 冻结 Mediation v1 接入标准框架（概念层 + 对接约束）。
2. 定义“外部输入 -> 内部统一模型”的映射规则。
3. 完成两类供给源的最小适配（联盟 + 模拟库）。
4. 输出接入指南与最小联调清单。

#### M2：编排与路由基线

1. 建立 placement 基础编排策略（按应用类型和场景）。
2. 建立供给路由顺序与回退顺序。
3. 建立超时、失败、降级的统一处理路径。
4. 打通核心请求链路的端到端调用。

#### M3：返回与回传基线

1. 统一广告返回结构与错误语义。
2. 打通核心事件回传链路（最小事件集）。
3. 建立请求级 trace 关联能力。
4. 建立基础审计与问题排查入口。

#### M4：稳定化与发布准备

1. 完成 v1 典型场景联调（正常、降级、回退）。
2. 完成运行手册（开关、降级、回滚）。
3. 完成发布检查清单并准备阶段发布。

### 7.5 v1 完成定义（Definition of Done）

1. 首批 AI 应用可按统一流程完成接入与联调。
2. Mediation 可在至少两类供给源之间稳定路由并返回结果。
3. 关键链路具备可追踪的请求与事件关联能力。
4. 异常场景下具备明确的降级与回退路径。
5. 文档、联调流程、运行手册可支持持续扩展。

### 7.6 当前限制因素与执行约束

1. 冷启动供给有限：优先保证可用性，逐步提升供给丰富度。
2. 外部网络接入受限：先通过联盟与模拟库建立可运行网络能力。
3. 研发资源有限：优先实现基线能力，避免一次性过度设计。
4. 场景变化快：保持模块边界清晰，确保后续可替换可扩展。

### 7.7 M1 对接约束清单（逐条定稿）

以下约束为 `M1` 阶段必须满足的接入标准框架要求。

#### A. 接入关系约束（必须）

1. 应用侧只对接 Mediation 统一入口，不与多个外部网络逐一直连。
2. 应用接入必须与业务主链路解耦，广告链路异常不得阻塞核心功能。
3. 所有接入方必须通过统一接入流程与统一联调清单完成上线前验证。

#### B. 接入对象约束（必须）

1. `M1` 阶段供给侧只包含两类：广告联盟供给与模拟广告库供给。
2. 两类供给都必须经过统一适配层，禁止将外部原始协议直接暴露给应用侧。
3. 模拟广告库按“标准供给源”管理，不作为临时旁路逻辑处理。

#### C. Placement 约束（必须）

1. 所有 placement 必须先注册再使用，禁止运行时无注册动态注入。
2. 每个 placement 必须有明确触发时机与降级行为定义。
3. `M1` 动态编排仅允许规则型策略，不引入复杂自动优化策略。

#### D. 请求处理约束（必须）

1. 所有应用请求必须先进入统一规范化处理，再进入路由决策。
2. 路由决策必须可解释、可复现，禁止不可追踪的黑箱分流。
3. 每次请求都必须存在明确的失败回退路径（如 no-fill、降级供给、直接返回）。

#### E. 响应输出约束（必须）

1. Mediation 对应用侧只输出统一响应语义，不输出供给侧私有语义。
2. 响应必须支持请求级关联能力，保证后续事件回传可以闭环追踪。
3. 无可用广告时必须显式返回可处理状态，不能以异常替代业务结果。

#### F. 事件回传约束（必须）

1. 事件回传链路必须覆盖最小闭环：请求处理结果、曝光、点击、失败。
2. 所有事件必须能关联到同一次请求上下文与对应 placement 上下文。
3. 事件回传失败不允许反向阻塞应用主链路，采用异步与容错机制处理。

#### G. 运行控制约束（必须）

1. 必须具备基础开关控制能力（按模块、按 placement、按供给源）。
2. 必须具备基础降级能力（供给失败、超时、异常场景）。
3. 必须具备基础回滚能力（配置回滚、策略回滚）。

#### H. 变更治理约束（必须）

1. 接入标准与路由策略变更必须可审计、可追溯。
2. 对外兼容性变更必须遵循版本化策略，避免破坏已有接入。
3. 每次阶段发布必须附带联调记录与运行检查清单。

### 7.8 M1 交付物清单（执行项）

1. Mediation v1 接入说明（面向应用侧）。
2. 供给适配说明（面向联盟与模拟库）。
3. Placement 注册与编排说明（面向内部运营与研发）。
4. 联调清单与发布清单（面向实施与上线）。
5. 运行手册（开关、降级、回滚）。

## 8. 变更记录

### 2026-02-21（v0.3）

1. 将 `M1` 从讨论入口升级为“逐条对接约束清单”。
2. 新增 A~H 八组必须约束，覆盖接入关系、供给、placement、请求、响应、事件、运行控制与治理。
3. 新增 `M1` 交付物清单，作为执行落地基线。

### 2026-02-21（v0.2）

1. 新增 `Mediation v1` 最小能力包执行计划。
2. 明确 v1 的 In Scope / Out of Scope。
3. 增加 M1~M4 里程碑、Substeps 与完成定义（DoD）。
4. 增加当前限制因素与下一轮讨论入口。

### 2026-02-21（v0.1）

1. 新建 Mediation 模块专属设计文档。
2. 建立模块使命、边界、能力框架与阶段演进主线。
3. 作为后续 Mediation 深度讨论的主入口文档。
