{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://ai-network.local/schemas/web-search-events.schema.json",
  "title": "WebSearchChainEvent",
  "type": "object",
  "required": [
    "eventId",
    "traceId",
    "sessionId",
    "turnId",
    "eventType",
    "occurredAt",
    "payload"
  ],
  "properties": {
    "eventId": { "type": "string", "minLength": 1 },
    "traceId": { "type": "string", "minLength": 1 },
    "requestId": { "type": "string", "minLength": 1 },
    "sessionId": { "type": "string", "minLength": 1 },
    "turnId": { "type": "string", "minLength": 1 },
    "eventType": {
      "type": "string",
      "enum": [
        "search_intent_detected",
        "tool_planned",
        "tool_called",
        "tool_succeeded",
        "tool_failed",
        "organic_results_received",
        "sponsored_results_received",
        "results_merged",
        "sponsored_impression",
        "sponsored_click",
        "answer_generated"
      ]
    },
    "occurredAt": { "type": "string", "format": "date-time" },
    "payload": {
      "type": "object",
      "properties": {
        "query": { "type": "string" },
        "rewrittenQuery": { "type": "string" },
        "toolName": { "type": "string" },
        "toolCallId": { "type": "string" },
        "toolStatus": { "type": "string", "enum": ["success", "timeout", "error"] },
        "toolLatencyMs": { "type": "integer", "minimum": 0 },
        "errorCode": { "type": "string" },
        "errorMessage": { "type": "string" },
        "organicCount": { "type": "integer", "minimum": 0 },
        "sponsoredCount": { "type": "integer", "minimum": 0 },
        "mergeMode": { "type": "string", "enum": ["separate_block", "blended"] },
        "adSlotIds": { "type": "array", "items": { "type": "string" } },
        "adId": { "type": "string" },
        "position": { "type": "integer", "minimum": 0 },
        "answerId": { "type": "string" }
      },
      "additionalProperties": true
    },
    "meta": {
      "type": "object",
      "properties": {
        "appId": { "type": "string" },
        "userId": { "type": "string" },
        "locale": { "type": "string" },
        "device": { "type": "string" },
        "model": { "type": "string" }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}
